import React, { useState } from 'react';
import { Users, Shuffle, RotateCcw, User } from 'lucide-react';

const StudentGrouper = () => {
  // VarsayÄ±lan isim listeleri (GÃ¼ncellenmiÅŸ Veriler)
  const defaultTrNames = [
    "Mustafa Onur YÄ±lmaz",
    "Hanife Ceyda YÄ±ldÄ±z",
    "Elif Ceren Korkmaz",
    "Egemen Cin",
    "Melis Su Ã‡elik",
    "Feyzanur YalÃ§Ä±n",
    "YiÄŸit Emin BaÅŸÄ±bÃ¼yÃ¼k",
    "Yasin Ã‡elik",
    "Berra Nur HoÅŸrenk",
    "Eren Sabit GÃ¶kÃ§en",
    "Ä°layda Nur AkÃ¶z",
    "Ã–mer Faruk ÅžÄ±k",
    "GÃ¼leÃ§ TerzioÄŸlu",
    "Hakan Åžahin"
  ].join('\n');

  const defaultItNames = [
    "Alessia De Martino",
    "Luigi Sorrentino",
    "Giovanni Cozzolino",
    "Christian Ascione",
    "Sarah Di Buono",
    "Chiara Cipolletta",
    "Angelo Borriello",
    "Iacopo Giuseppe Izzo",
    "Alessandro Picarelli",
    "Chiara Flauti",
    "Siria Cefariello",
    "Christian Nobile",
    "Ludovica Tramontano",
    "Antonio Scognamiglio"
  ].join('\n');

  const [trInput, setTrInput] = useState(defaultTrNames);
  const [itInput, setItInput] = useState(defaultItNames);
  
  // 14 tane boÅŸ grup oluÅŸtur
  const [groups, setGroups] = useState(Array(14).fill({ tr: null, it: null }));
  const [isGrouped, setIsGrouped] = useState(false);

  // KarÄ±ÅŸtÄ±rma Fonksiyonu (Fisher-Yates Shuffle)
  const shuffleArray = (array) => {
    let currentIndex = array.length, randomIndex;
    const newArray = [...array];

    while (currentIndex !== 0) {
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex--;
      [newArray[currentIndex], newArray[randomIndex]] = [
        newArray[randomIndex], newArray[currentIndex]];
    }

    return newArray;
  };

  const handleGroup = () => {
    // Girdileri satÄ±rlara bÃ¶l ve boÅŸ satÄ±rlarÄ± temizle
    const trList = trInput.split('\n').filter(name => name.trim() !== '');
    const itList = itInput.split('\n').filter(name => name.trim() !== '');

    // Listeleri karÄ±ÅŸtÄ±r
    const shuffledTr = shuffleArray(trList);
    const shuffledIt = shuffleArray(itList);

    // 14 grubu doldur
    const newGroups = Array(14).fill(null).map((_, index) => {
      return {
        tr: shuffledTr[index] || null, // EÄŸer Ã¶ÄŸrenci yetmezse boÅŸ bÄ±rak
        it: shuffledIt[index] || null
      };
    });

    setGroups(newGroups);
    setIsGrouped(true);
  };

  const handleReset = () => {
    setGroups(Array(14).fill({ tr: null, it: null }));
    setIsGrouped(false);
  };

  return (
    <div className="min-h-screen bg-gray-50 flex flex-col font-sans text-gray-800">
      {/* BaÅŸlÄ±k AlanÄ± */}
      <header className="bg-indigo-600 text-white p-4 shadow-md">
        <div className="container mx-auto flex items-center justify-between">
          <h1 className="text-2xl font-bold flex items-center gap-2">
            <Users size={28} />
            Ã–ÄŸrenci Grup OluÅŸturucu
          </h1>
          <span className="text-sm bg-indigo-500 px-3 py-1 rounded-full">
            TÃ¼rk & Ä°talyan EÅŸleÅŸmesi
          </span>
        </div>
      </header>

      <div className="flex flex-col lg:flex-row flex-1 overflow-hidden h-full">
        
        {/* SOL PANEL: Ä°sim Listeleri */}
        <aside className="w-full lg:w-1/4 bg-white border-r border-gray-200 p-4 flex flex-col gap-4 overflow-y-auto shadow-sm z-10">
          <div className="flex-1 flex flex-col">
            <label className="font-bold text-red-600 mb-2 flex items-center gap-2">
              ðŸ‡¹ðŸ‡· TÃ¼rk Ã–ÄŸrenciler
              <span className="text-xs font-normal text-gray-500 ml-auto">
                ({trInput.split('\n').filter(n => n.trim()).length})
              </span>
            </label>
            <textarea 
              className="flex-1 w-full p-3 border border-red-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent resize-none text-sm bg-red-50"
              placeholder="Ä°simleri buraya yapÄ±ÅŸtÄ±rÄ±n..."
              value={trInput}
              onChange={(e) => setTrInput(e.target.value)}
            />
          </div>

          <div className="flex-1 flex flex-col mt-4">
            <label className="font-bold text-green-600 mb-2 flex items-center gap-2">
              ðŸ‡®ðŸ‡¹ Ä°talyan Ã–ÄŸrenciler
              <span className="text-xs font-normal text-gray-500 ml-auto">
                ({itInput.split('\n').filter(n => n.trim()).length})
              </span>
            </label>
            <textarea 
              className="flex-1 w-full p-3 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none text-sm bg-green-50"
              placeholder="Ä°simleri buraya yapÄ±ÅŸtÄ±rÄ±n..."
              value={itInput}
              onChange={(e) => setItInput(e.target.value)}
            />
          </div>

          <div className="flex flex-col gap-2 mt-4">
            <button 
              onClick={handleGroup}
              className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors shadow-sm"
            >
              <Shuffle size={20} />
              Rastgele Grupla
            </button>
            <button 
              onClick={handleReset}
              className="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg flex items-center justify-center gap-2 transition-colors"
            >
              <RotateCcw size={18} />
              SÄ±fÄ±rla
            </button>
          </div>
        </aside>

        {/* SAÄž PANEL: Gruplar */}
        <main className="flex-1 bg-gray-100 p-6 overflow-y-auto">
          <div className="max-w-7xl mx-auto">
            <h2 className="text-xl font-semibold mb-4 text-gray-700">
              Grup Tablosu ({groups.length} Masa)
            </h2>
            
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 pb-10">
              {groups.map((group, index) => (
                <div 
                  key={index} 
                  className={`relative bg-white rounded-xl shadow-sm border-2 transition-all duration-300 overflow-hidden
                    ${isGrouped 
                      ? 'border-blue-500 transform hover:-translate-y-1 hover:shadow-md' 
                      : 'border-dashed border-gray-300 bg-gray-50'
                    }`}
                >
                  {/* Grup NumarasÄ± */}
                  <div className="absolute top-0 left-0 bg-gray-800 text-white text-xs font-bold px-2 py-1 rounded-br-lg z-10">
                    Grup {index + 1}
                  </div>

                  <div className="p-4 pt-8 space-y-3">
                    {/* TÃ¼rk Ã–ÄŸrenci Slotu */}
                    <div className="flex items-center gap-3 p-2 rounded-lg bg-red-50 border border-red-100">
                      <div className="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center text-red-600 shrink-0">
                        {group.tr ? <span className="text-lg">ðŸ‡¹ðŸ‡·</span> : <User size={16} />}
                      </div>
                      <div className="overflow-hidden">
                        <p className="text-xs text-red-500 font-semibold uppercase tracking-wider">TÃ¼rk Ã–ÄŸrenci</p>
                        <p className={`font-medium truncate ${!group.tr && 'text-gray-400 italic text-sm'}`}>
                          {group.tr || "Bekleniyor..."}
                        </p>
                      </div>
                    </div>

                    {/* Ä°talyan Ã–ÄŸrenci Slotu */}
                    <div className="flex items-center gap-3 p-2 rounded-lg bg-green-50 border border-green-100">
                      <div className="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600 shrink-0">
                        {group.it ? <span className="text-lg">ðŸ‡®ðŸ‡¹</span> : <User size={16} />}
                      </div>
                      <div className="overflow-hidden">
                        <p className="text-xs text-green-600 font-semibold uppercase tracking-wider">Ä°talyan Ã–ÄŸrenci</p>
                        <p className={`font-medium truncate ${!group.it && 'text-gray-400 italic text-sm'}`}>
                          {group.it || "Bekleniyor..."}
                        </p>
                      </div>
                    </div>
                  </div>
                  
                  {/* Dekoratif Alt Ã‡izgi */}
                  {isGrouped && (
                    <div className="h-1 w-full bg-gradient-to-r from-red-500 via-white to-green-500 opacity-50"></div>
                  )}
                </div>
              ))}
            </div>
          </div>
        </main>
      </div>
    </div>
  );
};

export default StudentGrouper;
